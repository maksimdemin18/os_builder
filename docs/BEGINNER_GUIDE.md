# –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö - OS Builder

## –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

OS Builder - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã—Ö –¥–∏—Å–∫–æ–≤ Ubuntu 24.04 LTS. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ubuntu –Ω–∞ 100 –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ - –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–∞–∂–¥–æ–≥–æ, —ç—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç "—É–º–Ω—ã–π" —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π –¥–∏—Å–∫, –∫–æ—Ç–æ—Ä—ã–π —Å–∞–º –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç.

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å Ubuntu 22.04 –∏–ª–∏ –Ω–æ–≤–µ–µ:
\`\`\`bash
lsb_release -a
\`\`\`

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
\`\`\`
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.3 LTS
Release:        22.04
Codename:       jammy
\`\`\`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞

–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 20 –ì–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞:
\`\`\`bash
df -h /
\`\`\`

–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –∫–æ–ª–æ–Ω–∫—É "Avail" - —Ç–∞–º –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 20G.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ –≤–∞—à –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –≤–∏—Ä—Ç—Éaliz–∞—Ü–∏—é:
\`\`\`bash
egrep -c '(vmx|svm)' /proc/cpuinfo
\`\`\`

–ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–æ–ª—å—à–µ 0 - –≤—Å–µ —Ö–æ—Ä–æ—à–æ. –ï—Å–ª–∏ 0 - –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ BIOS.

## –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
\`\`\`bash
chmod +x scripts/install-deps-manual.sh
./scripts/install-deps-manual.sh
\`\`\`

–°–∫—Ä–∏–ø—Ç —Å–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å sudo –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

### –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

1. **–û–±–Ω–æ–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É:**
   \`\`\`bash
   sudo apt update
   sudo apt upgrade -y
   \`\`\`

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:**
   \`\`\`bash
   sudo apt install -y \
     qemu-kvm libvirt-daemon-system libvirt-clients virtinst \
     cloud-image-utils xorriso isolinux syslinux-utils \
     p7zip-full curl jq wget git ansible python3-pip \
     build-essential
   \`\`\`

3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Packer:**
   \`\`\`bash
   # –°–∫–∞—á–∏–≤–∞–µ–º Packer
   PACKER_VERSION="1.11.2"
   curl -fsSL "https://releases.hashicorp.com/packer/${PACKER_VERSION}/packer_${PACKER_VERSION}_linux_amd64.zip" -o /tmp/packer.zip
   
   # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
   sudo unzip -o /tmp/packer.zip -d /usr/local/bin
   sudo chmod +x /usr/local/bin/packer
   
   # –ü—Ä–æ–≤–µ—Ä—è–µ–º
   packer version
   \`\`\`

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   \`\`\`bash
   # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—ã
   sudo usermod -a -G libvirt,kvm $USER
   
   # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä—É–ø–ø—ã (–∏–ª–∏ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å)
   newgrp libvirt
   \`\`\`

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É:**
   \`\`\`bash
   # –ü—Ä–æ–≤–µ—Ä—è–µ–º KVM
   kvm-ok
   
   # –ü—Ä–æ–≤–µ—Ä—è–µ–º libvirt
   virsh list --all
   
   # –ü—Ä–æ–≤–µ—Ä—è–µ–º Packer
   packer version
   
   # –ü—Ä–æ–≤–µ—Ä—è–µ–º Ansible
   ansible --version
   \`\`\`

## –®–∞–≥ 4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏

–ï—Å–ª–∏ —É –≤–∞—Å Ubuntu 24.10 –∏–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏ —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏:

\`\`\`bash
chmod +x scripts/fix-repositories.sh
./scripts/fix-repositories.sh
\`\`\`

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Ubuntu 24.04.

## –®–∞–≥ 5: –ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã:
\`\`\`bash
chmod +x scripts/diagnose-system.sh
./scripts/diagnose-system.sh
\`\`\`

–°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ —á—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Packer

\`\`\`bash
cd packer
packer init .
cd ..
\`\`\`

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–µ–π

–°–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ–±—Ä–∞–Ω–Ω—ã–º —Å–∏—Å—Ç–µ–º–∞–º:
\`\`\`bash
# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∫–ª—é—á–µ–π
mkdir -p keys

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏
ssh-keygen -t ed25519 -f keys/support_key -N "" -C "support@company.local"

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
ssh-keygen -t ed25519 -f keys/admin_key -N "" -C "admin@company.local"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏ (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏—Ö)
echo "=== –ö–ª—é—á –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ==="
cat keys/support_key.pub
echo "=== –ö–ª—é—á –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ==="
cat keys/admin_key.pub
\`\`\`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–æ–ª–µ–π

–°–æ–∑–¥–∞–π—Ç–µ —Ö–µ—à–∏ –ø–∞—Ä–æ–ª–µ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
\`\`\`bash
# –°–æ–∑–¥–∞–µ–º —Ö–µ—à –ø–∞—Ä–æ–ª—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è support
echo "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è support:"
python3 -c "import crypt; print(crypt.crypt(input(), crypt.mksalt(crypt.METHOD_SHA512)))"

# –°–æ–∑–¥–∞–µ–º —Ö–µ—à –ø–∞—Ä–æ–ª—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è admin  
echo "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è admin:"
python3 -c "import crypt; print(crypt.crypt(input(), crypt.mksalt(crypt.METHOD_SHA512)))"
\`\`\`

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ö–µ—à–∏ - –æ–Ω–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ autoinstall

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `packer/http/user-data` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à–∏ SSH –∫–ª—é—á–∏ –∏ –ø–∞—Ä–æ–ª–∏:

\`\`\`bash
nano packer/http/user-data
\`\`\`

–ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é `identity` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ:
\`\`\`yaml
identity:
  hostname: ubuntu-server
  password: "$6$–≤–∞—à_—Ö–µ—à_–ø–∞—Ä–æ–ª—è_root"
  username: ubuntu
\`\`\`

–ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é `user-data` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à–∏ –∫–ª—é—á–∏:
\`\`\`yaml
ssh_authorized_keys:
  - "ssh-ed25519 AAAA... support@company.local"
  - "ssh-ed25519 AAAA... admin@company.local"
\`\`\`

### –°–±–æ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞

–¢–µ–ø–µ—Ä—å —Å–æ–±–µ—Ä–µ–º –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑:

\`\`\`bash
cd packer

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä–∫—É —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
PACKER_LOG=1 packer build -var 'profile=base' .
\`\`\`

–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–π–º–µ—Ç 15-30 –º–∏–Ω—É—Ç. –í—ã —É–≤–∏–¥–∏—Ç–µ:
1. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ Ubuntu ISO (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–∫–∞—á–∞–Ω)
2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É Ubuntu
4. –ù–∞—Å—Ç—Ä–æ–π–∫—É —Å–∏—Å—Ç–µ–º—ã —á–µ—Ä–µ–∑ Ansible
5. –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞

### –°–æ–∑–¥–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–æ–≥–æ ISO

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏ –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ —Å–æ–∑–¥–∞–π—Ç–µ ISO:

\`\`\`bash
cd ../live-build

# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x mkiso.sh

# –°–æ–∑–¥–∞–µ–º ISO –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è base
sudo ./mkiso.sh base
\`\`\`

–ì–æ—Ç–æ–≤—ã–π ISO –±—É–¥–µ—Ç –≤ –ø–∞–ø–∫–µ `dist/`:
\`\`\`bash
ls -lh dist/
\`\`\`

## –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π ISO:
\`\`\`bash
# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x live-build/test-iso.sh

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
./live-build/test-iso.sh dist/ubuntu-24.04-base.iso
\`\`\`

### –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ ISO –≤ QEMU –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
\`\`\`bash
# –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–∏—Å–∫ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
qemu-img create -f qcow2 /tmp/test-disk.qcow2 20G

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É
qemu-system-x86_64 \
  -enable-kvm \
  -m 2048 \
  -cpu host \
  -cdrom dist/ubuntu-24.04-base.iso \
  -hda /tmp/test-disk.qcow2 \
  -boot d \
  -vnc :1
\`\`\`

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ VNC –Ω–∞ –ø–æ—Ä—Ç—É 5901 –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.

## –®–∞–≥ 7: –°–æ–∑–¥–∞–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π

### –°–±–æ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è —Ä–∞–±–æ—á–∏—Ö —Å—Ç–∞–Ω—Ü–∏–π (dw)

\`\`\`bash
cd packer
packer build -var 'profile=dw' .
cd ../live-build
sudo ./mkiso.sh dw
\`\`\`

### –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π

\`\`\`bash
# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x live-build/build-all-profiles.sh

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä–∫—É –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
./live-build/build-all-profiles.sh
\`\`\`

## –®–∞–≥ 8: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –≤ –ø—Ä–æ—Ñ–∏–ª—å

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –ø—Ä–æ—Ñ–∏–ª—è, –Ω–∞–ø—Ä–∏–º–µ—Ä `profiles/base.yaml`:

\`\`\`bash
nano profiles/base.yaml
\`\`\`

–î–æ–±–∞–≤—å—Ç–µ –Ω—É–∂–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –≤ —Å–µ–∫—Ü–∏—é `packages`:
\`\`\`yaml
packages:
  - htop
  - mc
  - vim
  - curl
  - wget
  - git
  - –≤–∞—à-–Ω–æ–≤—ã–π-–ø–∞–∫–µ—Ç
\`\`\`

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –±–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å:
   \`\`\`bash
   cp profiles/base.yaml profiles/myprofile.yaml
   \`\`\`

2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å:
   \`\`\`bash
   nano profiles/myprofile.yaml
   \`\`\`

3. –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ:
   \`\`\`yaml
   name: "MyProfile"
   description: "–ú–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å"
   \`\`\`

4. –î–æ–±–∞–≤—å—Ç–µ –Ω—É–∂–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

5. –°–æ–∑–¥–∞–π—Ç–µ Ansible —Ä–æ–ª—å:
   \`\`\`bash
   mkdir -p ansible/roles/profile/myprofile/tasks
   nano ansible/roles/profile/myprofile/tasks/main.yml
   \`\`\`

6. –°–æ–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å:
   \`\`\`bash
   cd packer
   packer build -var 'profile=myprofile' .
   cd ../live-build
   sudo ./mkiso.sh myprofile
   \`\`\`

## –®–∞–≥ 9: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ Ubuntu

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ Ubuntu 24.10

1. –ù–∞–π–¥–∏—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π ISO:
   \`\`\`bash
   curl -s https://releases.ubuntu.com/24.10/ | grep "live-server-amd64.iso"
   \`\`\`

2. –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É:
   \`\`\`bash
   curl -s https://releases.ubuntu.com/24.10/SHA256SUMS | grep live-server-amd64.iso
   \`\`\`

3. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
   \`\`\`bash
   nano packer/variables.pkr.hcl
   \`\`\`

   –ò–∑–º–µ–Ω–∏—Ç–µ:
   ```hcl
   variable "iso_url" {
     default = "https://releases.ubuntu.com/24.10/ubuntu-24.10-live-server-amd64.iso"
   }
   
   variable "iso_checksum" {
     default = "sha256:–Ω–æ–≤–∞—è_–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è_—Å—É–º–º–∞"
   }
   \`\`\`

4. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã:
   \`\`\`bash
   cd packer
   packer build .
   \`\`\`

## –®–∞–≥ 10: –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "Permission denied" –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
\`\`\`bash
chmod +x scripts/*.sh
chmod +x live-build/*.sh
\`\`\`

### –ü—Ä–æ–±–ª–µ–º–∞: "KVM not available"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏:
   \`\`\`bash
   egrep -c '(vmx|svm)' /proc/cpuinfo
   \`\`\`

2. –í–∫–ª—é—á–∏—Ç–µ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –≤ BIOS

3. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—ã:
   \`\`\`bash
   sudo usermod -a -G libvirt,kvm $USER
   newgrp libvirt
   \`\`\`

### –ü—Ä–æ–±–ª–µ–º–∞: "Repository not found" –∏–ª–∏ 404 –æ—à–∏–±–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
\`\`\`bash
./scripts/fix-repositories.sh
\`\`\`

### –ü—Ä–æ–±–ª–µ–º–∞: "No space left on device"

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—á–∏—Å—Ç–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
   \`\`\`bash
   sudo apt clean
   rm -rf /tmp/packer*
   \`\`\`

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Å—Ç–æ:
   \`\`\`bash
   df -h
   \`\`\`

### –ü—Ä–æ–±–ª–µ–º–∞: Packer "–∑–∞–≤–∏—Å–∞–µ—Ç" –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –≤ `packer/main.pkr.hcl`:
   ```hcl
   boot_wait = "10s"
   ssh_timeout = "30m"
   \`\`\`

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   \`\`\`bash
   PACKER_LOG=1 packer build .
   \`\`\`

## –®–∞–≥ 11: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏:

\`\`\`bash
cat > auto-build.sh << 'EOF'
#!/bin/bash

LOG_FILE="/var/log/os-builder.log"
DATE=$(date '+%Y-%m-%d %H:%M:%S')

echo "[$DATE] –ù–∞—á–∞–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏" >> $LOG_FILE

# –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Git)
git pull >> $LOG_FILE 2>&1

# –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏
./live-build/build-all-profiles.sh >> $LOG_FILE 2>&1

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞–∑—ã
for iso in dist/*.iso; do
    echo "[$DATE] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ $iso" >> $LOG_FILE
    ./live-build/test-iso.sh "$iso" >> $LOG_FILE 2>&1
done

echo "[$DATE] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞" >> $LOG_FILE
EOF

chmod +x auto-build.sh
\`\`\`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –¥–ª—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏

\`\`\`bash
# –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –≤ cron
(crontab -l 2>/dev/null; echo "0 2 * * 1 cd $(pwd) && ./auto-build.sh") | crontab -
\`\`\`

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

\`\`\`bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–±–æ—Ä–∫–∏
tail -f /tmp/packer-build.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–æ–≤
ls -lh dist/

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
rm -rf /tmp/packer*
sudo apt clean

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
systemctl status libvirtd

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö ISO –æ–±—Ä–∞–∑–æ–≤
find . -name "*.iso" -exec ls -lh {} \;

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º
sha256sum dist/*.iso

# –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ISO –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
sudo mkdir /mnt/iso
sudo mount -o loop dist/ubuntu-24.04-base.iso /mnt/iso
ls -la /mnt/iso/
sudo umount /mnt/iso
\`\`\`

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ Ubuntu. –í—ã –º–æ–∂–µ—Ç–µ:

1. **–°–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—Ä–∞–∑—ã** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
2. **–î–æ–±–∞–≤–ª—è—Ç—å –ø–∞–∫–µ—Ç—ã** —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
3. **–ú–µ–Ω—è—Ç—å –≤–µ—Ä—Å–∏–∏** Ubuntu
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑—ã** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–±–æ—Ä–∫—É** —á–µ—Ä–µ–∑ cron

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑–¥–µ–ª—É "–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º" –∏–ª–∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç:
\`\`\`bash
./scripts/diagnose-system.sh
\`\`\`

–£–¥–∞—á–∏ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ OS Builder! üöÄ
